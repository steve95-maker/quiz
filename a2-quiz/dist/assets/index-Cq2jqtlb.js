(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();class l{constructor(){this.interval=null,this.remainingTime=0,this.startTime=null}start(e,n){this.stop(),this.remainingTime=e,this.startTime=Date.now();const r=document.getElementById("timer");this.interval=setInterval(()=>{const t=Math.floor((Date.now()-this.startTime)/1e3),i=e-t;i<=0?(this.stop(),n()):r&&(r.textContent=`Time left: ${i}`)},500)}stop(){this.interval&&(clearInterval(this.interval),this.interval=null)}getElapsedTime(){return this.startTime?Math.floor((Date.now()-this.startTime)/1e3):0}reset(){this.stop(),this.remainingTime=0,this.startTime=null}}class u{constructor(e,n,r){this.renderView=e,this.renderStartScreen=n,this.highscore=r,this.timer=null,this.nickname="",this.currentQuestion=null,this.nextURL="https://courselab.lnu.se/quiz/question/1",this.totalTime=0}async start(e){this.nickname=e,this.timer=new l,await this.fetchQuestion()}async fetchQuestion(){try{const e=await fetch(this.nextURL);this.currentQuestion=await e.json(),this.showQuestion()}catch(e){console.error("Error fetching question:",e),this.showGameOver("Failed to fetch the question! Game over.")}}showQuestion(){const e=document.createElement("div");e.innerHTML=`
      <h2>${this.currentQuestion.question}</h2>
      <div id="answers"></div>
      <p id="timer">Time left: 10</p>
    `;const n=e.querySelector("#answers");if(this.currentQuestion.alternatives)for(const[r,t]of Object.entries(this.currentQuestion.alternatives)){const i=document.createElement("button");i.textContent=t,i.addEventListener("click",()=>this.submitAnswer(r)),n.appendChild(i)}else{const r=document.createElement("input"),t=document.createElement("button");t.textContent="Submit",t.addEventListener("click",()=>this.submitAnswer(r.value)),n.appendChild(r),n.appendChild(t)}this.renderView(e),this.timer.start(10,()=>this.showGameOver("Time's up! Game over."))}async submitAnswer(e){try{const n=await fetch(this.currentQuestion.nextURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answer:e})});if(!n.ok){const t=await n.json();console.log("Server Error:",t.message),this.timer.stop(),this.showGameOver("Wrong answer! Game over.");return}const r=await n.json();console.log(r.message),this.totalTime+=this.timer.getElapsedTime(),this.generateConfetti(),r.nextURL?(this.nextURL=r.nextURL,this.fetchQuestion()):(this.timer.stop(),this.showVictoryScreen())}catch(n){console.error("Error submitting answer:",n),this.showGameOver("An error occurred! Game over.")}}async showVictoryScreen(){const e=document.createElement("div");e.innerHTML=`
      <h2>Congratulations, ${this.nickname}! You completed the quiz!</h2>
      <p>Your time: ${this.totalTime} seconds</p>
      <button id="restart-btn">Play Again</button>
    `,e.querySelector("#restart-btn").addEventListener("click",()=>{this.resetGame()}),this.highscore.save({nickname:this.nickname,time:this.totalTime}),this.renderView(e)}showGameOver(e="Game Over"){this.timer.stop();const n=document.createElement("div");n.innerHTML=`
      <h2>${e}</h2>
      <button id="restart-btn">Play Again</button>
      <button id="highscore-btn">High Scores</button>
    `,n.querySelector("#restart-btn").addEventListener("click",()=>{this.resetGame()}),n.querySelector("#highscore-btn").addEventListener("click",()=>{this.highscore.show()}),this.renderView(n)}resetGame(){this.timer&&this.timer.stop(),this.nextURL="https://courselab.lnu.se/quiz/question/1",this.currentQuestion=null,this.nickname="",this.renderStartScreen()}generateConfetti(){const e=["#ffcc00","#ff6699","#66ccff","#66ff66","#ff6666"],n=document.body;for(let r=0;r<50;r++){const t=document.createElement("div");t.classList.add("confetti"),t.style.left=`${Math.random()*100}vw`,t.style.setProperty("--color",e[Math.floor(Math.random()*e.length)]),t.style.animationDelay=`${Math.random()*2}s`,n.appendChild(t),setTimeout(()=>{t.remove()},2e3)}}}class m{constructor(e){this.renderView=e,this.key="quiz_highscores"}save(e){const n=JSON.parse(localStorage.getItem(this.key))||[];n.push(e),n.sort((r,t)=>r.time-t.time),localStorage.setItem(this.key,JSON.stringify(n.slice(0,5)))}show(){const e=document.createElement("div");e.innerHTML="<h2>High Scores</h2>";const n=JSON.parse(localStorage.getItem(this.key))||[],r=document.createElement("ol");n.forEach(i=>{const o=document.createElement("li");o.textContent=`${i.nickname}: ${i.time} seconds`,r.appendChild(o)}),e.appendChild(r);const t=document.createElement("button");t.textContent="Back",t.addEventListener("click",()=>{this.renderView(this.createStartScreen())}),e.appendChild(t),this.renderView(e)}createStartScreen(){const e=document.createElement("div");return e.innerHTML=`
      <h1>Quiz Game</h1>
      <input id="nickname" type="text" placeholder="Enter your nickname" />
      <button id="start-btn">Start Quiz</button>
      <button id="highscore-btn">High Scores</button>
    `,e.querySelector("#start-btn").addEventListener("click",()=>{const n=e.querySelector("#nickname").value;n.trim()?this.startGame(n):alert("Please enter a nickname to start!")}),e.querySelector("#highscore-btn").addEventListener("click",()=>{this.show()}),e}}const a=document.getElementById("app"),c=s=>{a.innerHTML="",a.appendChild(s)},h=()=>{const s=new m(c),e=new u(c,h,s),n=document.createElement("div");n.innerHTML=`
    <h1>Quiz Game</h1>
    <input id="nickname" type="text" placeholder="Enter your nickname" />
    <button id="start-btn">Start Quiz</button>
    <button id="highscore-btn">High Scores</button>
  `,n.querySelector("#start-btn").addEventListener("click",()=>{const r=n.querySelector("#nickname").value;r.trim()?e.start(r):alert("Please enter a nickname to start!")}),n.querySelector("#highscore-btn").addEventListener("click",()=>{s.show()}),c(n)};h();
